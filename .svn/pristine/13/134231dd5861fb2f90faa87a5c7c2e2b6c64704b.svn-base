<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.sales.dao.SalesDao">


	<!--전체 자료 조회 -->
	<select id="selectSales" resultType="SalesVO">
	SELECT
	ROW_NUMBER() OVER (ORDER BY SALES_MONTHLY.SALES_DEPT_CODE,
	SALES_MONTHLY.SALES_YEAR, SALES_MONTHLY.SALES_MONTH) AS rnum,
	SALES_MONTHLY.SALES_DEPT_CODE,
	DEPARTMENT.DEPT_NM,
	SALES_MONTHLY.SALES_YEAR,
	SALES_MONTHLY.SALES_MONTH,
	SALES_MONTHLY.SALES_AMOUNT AS deptAmount,
	SALES_MONTHLY.CLINIC_CUSTOMER AS clinicCustomer,
	SALES_MONTHLY.HOSPITAL_CUSTOMER AS hospitalCustomer
	FROM
	SALES_MONTHLY
	JOIN DEPARTMENT ON (SALES_MONTHLY.SALES_DEPT_CODE = DEPARTMENT.DEPT_CODE)
	ORDER BY
	SALES_MONTHLY.SALES_DEPT_CODE,
	SALES_MONTHLY.SALES_YEAR,
	SALES_MONTHLY.SALES_MONTH
	</select>

	<!--월별 매출액 조회-->
	<select id="selectMonthSales" resultType="SalesVO">
	SELECT
		SALES_YEAR
		, SALES_MONTH
		, SUM(SALES_AMOUNT) AS totalSalesAmount
	FROM
		SALES_MONTHLY
	GROUP BY
		SALES_YEAR
		, SALES_MONTH
	ORDER BY
		SALES_YEAR
		, SALES_MONTH
	</select>

	
	<!--병원 분기별 총 매출액 -->
	<select id="selectQuarterSales" resultType="SalesVO">
 SELECT
		SALES_YEAR,
	CASE
		WHEN SALES_MONTH BETWEEN 1 AND 3 THEN '1'
		WHEN SALES_MONTH BETWEEN 4 AND 6 THEN '2'
		WHEN SALES_MONTH BETWEEN 7 AND 9 THEN '3'
		ELSE '4'
		END AS QUARTER,
		SUM(SALES_AMOUNT) AS totalSalesAmount
	FROM
		SALES_MONTHLY
	GROUP BY
		SALES_YEAR,
		CASE
		WHEN SALES_MONTH BETWEEN 1 AND 3 THEN '1'
		WHEN SALES_MONTH BETWEEN 4 AND 6 THEN '2'
		WHEN SALES_MONTH BETWEEN 7 AND 9 THEN '3'
		ELSE '4'
	END
	ORDER BY
		SALES_YEAR, QUARTER
	</select>
	
	
	
	<!--부서별 분기별 매출액 -->
	<select id="selectEmpQuarterSales" resultType="SalesVO">
	 SELECT
		SALES_MONTHLY.SALES_YEAR, DEPARTMENT.DEPT_NM,
	CASE
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 1 AND 3 THEN '1'
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 4 AND 6 THEN '2'
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 7 AND 9 THEN '3'
		ELSE '4'
	
	END AS QUARTER,
	SUM(SALES_MONTHLY.SALES_AMOUNT) AS totalSalesAmount,
    SUM(SALES_MONTHLY.CLINIC_CUSTOMER) AS clinicCustomer,
    SUM(SALES_MONTHLY.HOSPITAL_CUSTOMER) AS hospitalCustomer
	
	FROM
		SALES_MONTHLY
	JOIN
		DEPARTMENT ON SALES_MONTHLY.SALES_DEPT_CODE = DEPARTMENT.DEPT_CODE
	GROUP BY
		SALES_MONTHLY.SALES_YEAR, DEPARTMENT.DEPT_NM,
	CASE
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 1 AND 3 THEN '1'
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 4 AND 6 THEN '2'
		WHEN SALES_MONTHLY.SALES_MONTH BETWEEN 7 AND 9 THEN '3'
		ELSE '4'
		END
	ORDER BY
	SALES_MONTHLY.SALES_YEAR, QUARTER
	</select>

	
	
</mapper>