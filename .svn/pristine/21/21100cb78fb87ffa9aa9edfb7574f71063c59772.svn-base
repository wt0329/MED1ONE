<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.sales.dao.SalesDao">

	<!--전체 자료 조회 -->
	<select id="selectSales" resultType="SalesVO">
		SELECT
			SALES_DEPT_CODE, SALES_YEAR, SALES_MONTH,
			SALES_AMOUNT, CLINIC_CUSTOMER, HOSPITAL_CUSTOMER,
			DEPT_NM
		FROM
			SALES_MONTHLY JOIN DEPARTMENT
			ON(SALES_MONTHLY.SALES_DEPT_CODE=DEPARTMENT.DEPT_CODE)
	</select>

	
	<!--병원 분기별 총 매출액 -->
	<select id="selectQuarterSales" resultType="SalesVO">
	SELECT
		SALES_YEAR,
	CASE
		WHEN SALES_MONTH BETWEEN 1 AND 3 THEN 'Q1'
		WHEN SALES_MONTH BETWEEN 4 AND 6 THEN 'Q2'
		WHEN SALES_MONTH BETWEEN 7 AND 9 THEN 'Q3'
		ELSE 'Q4'
		END AS QUARTER,
		SUM(SALES_AMOUNT) AS TOTAL_SALES_AMOUNT
	FROM
		SALES_MONTHLY
	GROUP BY
		SALES_YEAR,
		CASE
		WHEN SALES_MONTH BETWEEN 1 AND 3 THEN 'Q1'
		WHEN SALES_MONTH BETWEEN 4 AND 6 THEN 'Q2'
		WHEN SALES_MONTH BETWEEN 7 AND 9 THEN 'Q3'
		ELSE 'Q4'
	END
	ORDER BY
		SALES_YEAR, QUARTER
	</select>
	
	
	
	<!--부서별 분기별 매출액 -->
	<select id="selectEmpQuarterSales" resultType="SalesVO">

	SELECT
		SM.SALES_YEAR, D.DEPT_NM,
	CASE
		WHEN SM.SALES_MONTH BETWEEN 1 AND 3 THEN 'Q1'
		WHEN SM.SALES_MONTH BETWEEN 4 AND 6 THEN 'Q2'
		WHEN SM.SALES_MONTH BETWEEN 7 AND 9 THEN 'Q3'
		ELSE 'Q4'
	
	END AS QUARTER,
	SUM(SM.SALES_AMOUNT) AS TOTAL_SALES_AMOUNT
	
	FROM
		SALES_MONTHLY SM
	JOIN
		DEPARTMENT D ON SM.SALES_DEPT_CODE = D.DEPT_CODE
	GROUP BY
		SM.SALES_YEAR, D.DEPT_NM,
	CASE
		WHEN SM.SALES_MONTH BETWEEN 1 AND 3 THEN 'Q1'
		WHEN SM.SALES_MONTH BETWEEN 4 AND 6 THEN 'Q2'
		WHEN SM.SALES_MONTH BETWEEN 7 AND 9 THEN 'Q3'
		ELSE 'Q4'
		END
	ORDER BY
	SM.SALES_YEAR, QUARTER
	</select>

	
	
</mapper>