<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8" buffer="8kb"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>

<!doctype html>
<html class="no-js" lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author"
	content="Mark Otto, Jacob Thornton, and Bootstrap contributors">

<meta name="generator" content="Hugo 0.88.1">
<meta name="theme-color" content="#6aab9c">

<title>WELCOME MED1ONE<%-- <tiles:getAsString name="title" /> --%></title>

<tiles:insertAttribute name="preScript" />

<style>
.bd-placeholder-img {
	font-size: 1.125rem;
	text-anchor: middle;
	-webkit-user-select: none;
	-moz-user-select: none;
	user-select: none;
}

@media ( min-width : 768px) {
	.bd-placeholder-img-lg {
		font-size: 3.5rem;
	}
}

.navbar {
	background-color: #6aab9c;
	font-size: 14px;
	font-weight: bolder;

}

</style>
<!-- Custom styles for this template -->
<link href="<%=request.getContextPath()%>/resources/css/dashboard.css" rel="stylesheet">

<link rel="stylesheet" href="<%=request.getContextPath()%>/resources/dist/assets/css/ihealth.style.min.css">
    
<!-- Plugin css file  -->
<link rel="stylesheet" href="${pageContext.request.contextPath}/resources/dist/assets/plugin/owlcarousel/owl.carousel.min.css">

</head>


<body class="d-flex flex-column vh-100">





								
									<!-- 환자 검색 시작 -->

									<div class="col-md-12 col-lg-6"
										style="width: 100%;  margin-right: 1px">
										<div class="card mb-3">
											<div
												class="card-header py-3 d-flex justify-content-between bg-transparent border-bottom-0"
												style="height: 0px;">
												<h6 class="mb-0 fw-bold">환자 정보</h6>
											</div>
											<div class="card-body">

												<ul class="nav nav-tabs mb-3" id="myTab2" role="tablist">

													<li class="nav-item" role="presentation">Search: <input
														type="search" class="form-control" id="searchForm"
														placeholder="" aria-controls="myDataTable" />
													</li>
													
												</ul>

												<!-- 환자 -->
												<div class="tab-pane" id="tab6" role="tabpanel"
													aria-labelledby="tab6-tab">
													<table class="table table-hover align-middle mb-0"
														style="height: 100px;">
														<thead>
															<tr>
																<th id="patntCode">환자 코드</th>
				                                                <th id="patntNm">환자명</th>
				                                                <th id="patntIdentino">주민번호</th>
				                                                <th id="height">키</th>
				                                                <th id="weight">몸무게</th>
				                                                <th id="patntTelno">전화번호</th>
				                                                <th id="patntZipcode">우편번호</th>
				                                                <th id="patntAddr1">주소</th>
				                                                <th id="patntAddr2">상세주소</th>
				                                                <th id="gen">성별</th>
				                                                <th id="patEmail">이메일</th>
																
															</tr>
														</thead>
														<tbody id="myProjectTable3">
														</tbody>
													</table>
												</div>
												<!-- 환자 end -->

											</div>
										</div>
									</div>
					
					

<!-- Jquery Core Js -->
<script
	src="<%=request.getContextPath()%>/resources/dist/assets/bundles/libscripts.bundle.js"></script>

<!-- Plugin Js -->
<script
	src="<%=request.getContextPath()%>/resources/dist/assets/bundles/apexcharts.bundle.js"></script>
<script
	src="<%=request.getContextPath()%>/resources/dist/assets/plugin/jqueryuicalandar/jquery-ui.min.js"></script>
<script
	src="<%=request.getContextPath()%>/resources/dist/assets/plugin/owlcarousel/owl.carousel.js"></script>
<script
	src="<%=request.getContextPath()%>/resources/dist/assets/bundles/dataTables.bundle.js"></script>

<!-- Jquery Page Js -->
<script src="<%=request.getContextPath()%>/resources/js/template.js"></script>
<script src="<%=request.getContextPath()%>/resources/js/page/index.js"></script>				
<script>
$('#myDataTable').addClass('nowrap').dataTable({
	responsive : true,
	columnDefs : [ {
		targets : [ -1, -3 ],
		className : 'dt-body-right'
	} ]
});

let searchForm = $("#searchForm").on("change",function(event) {
	let patntNm = $(this).val();
	$.getJSON("<c:url value='/administ/patientSearch.do' />",{patntNm:patntNm }).done(function(resp) {
		let tbody = $("#myProjectTable3");
		tbody.empty();
		if (resp.length > 0) {$(resp).each(function(idx,patientList) {
			let tr = $("<tr>").append(
				$("<td>").html(patientList.patntCode),
				$("<td>").html(patientList.patntNm),
				$("<td>").html(patientList.patntIdentino),
				$("<td>").html(patientList.patntTelno),
				$("<td>").html(patientList.patntAddr1),
				$("<td>").html(patientList.patntAddr2),
				$("<td>").html(patientList.patntZipcode),
				$("<td>").html(patientList.height),
				$("<td>").html(patientList.weight),
				$("<td>").html(patientList.gen),
				$("<td>").html(patientList.patEmail)
				);
					tbody.append(tr);
				});
		} else {
			tbody.append($("<tr>").html($("<td colsapn='11'>").html("해당 환자가 존재하지 않습니다.")));
		}	
	});
});

$(document).ready(function() {
    // 환자 정보 테이블에서 행 클릭 이벤트 처리
    $('#myProjectTable3').on('click', 'tr', function() {
        // 클릭한 행에서 데이터를 읽어옴
        var patntCode = $(this).find('td:eq(0)').text();
        var patntNm = $(this).find('td:eq(1)').text();
        var patntIdentino = $(this).find('td:eq(2)').text();
        var patntTelno = $(this).find('td:eq(3)').text();
        var patntAddr1 = $(this).find('td:eq(4)').text();
        var patntAddr2 = $(this).find('td:eq(5)').text();
        var patntZipcode = $(this).find('td:eq(6)').text();
        var height = $(this).find('td:eq(7)').text();
        var weight = $(this).find('td:eq(8)').text();
        var gen = $(this).find('td:eq(9)').text();
        var patEmail = $(this).find('td:eq(10)').text();

        // 부모 창의 함수 호출하여 데이터 전달
        window.opener.receivePatientData(patntCode, patntNm, patntIdentino, patntTelno, patntAddr1, patntAddr2, patntZipcode, height, weight, gen, patEmail);

        // 자식 창 닫기
        window.close();
    });
});


</script>

</body>
</html>